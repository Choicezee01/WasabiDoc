<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Pay to EndPoint | Wasabi Docs</title>
    <meta name="description" content="A detailed explanation of how Pay to EndPoint can be used to hide transaction metadata in a collaborative CoinJoin. This is the Wasabi documentation, an archive of knowledge about the open-source, non-custodial and privacy-focused Bitcoin wallet for desktop.">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#211b24">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata:400,700|Playfair+Display:700&amp;display=swap">
  <meta name="msapplication-TileColor" content="#211b24">
  <meta name="theme-color" content="#211b24">
    
    <link rel="preload" href="/assets/css/0.styles.b1b38d49.css" as="style"><link rel="preload" href="/assets/js/app.530dcfea.js" as="script"><link rel="preload" href="/assets/js/3.b572bdb5.js" as="script"><link rel="preload" href="/assets/js/44.63e6a1bf.js" as="script"><link rel="prefetch" href="/assets/js/10.2dcbc0df.js"><link rel="prefetch" href="/assets/js/11.8bef844f.js"><link rel="prefetch" href="/assets/js/12.99e55a8a.js"><link rel="prefetch" href="/assets/js/13.0d2a10a3.js"><link rel="prefetch" href="/assets/js/14.023ea9ca.js"><link rel="prefetch" href="/assets/js/15.512bb7b9.js"><link rel="prefetch" href="/assets/js/16.9c7e4cd0.js"><link rel="prefetch" href="/assets/js/17.6911886c.js"><link rel="prefetch" href="/assets/js/18.d00c9061.js"><link rel="prefetch" href="/assets/js/19.cc239c14.js"><link rel="prefetch" href="/assets/js/20.a5ebb280.js"><link rel="prefetch" href="/assets/js/21.bb9f63f2.js"><link rel="prefetch" href="/assets/js/22.2bb353d0.js"><link rel="prefetch" href="/assets/js/23.637a3b61.js"><link rel="prefetch" href="/assets/js/24.97d17834.js"><link rel="prefetch" href="/assets/js/25.7c1320af.js"><link rel="prefetch" href="/assets/js/26.c2212b69.js"><link rel="prefetch" href="/assets/js/27.2e6eafe0.js"><link rel="prefetch" href="/assets/js/28.80b1140b.js"><link rel="prefetch" href="/assets/js/29.0f0db370.js"><link rel="prefetch" href="/assets/js/30.750cd558.js"><link rel="prefetch" href="/assets/js/31.38f5089d.js"><link rel="prefetch" href="/assets/js/32.3075de8a.js"><link rel="prefetch" href="/assets/js/33.919704a5.js"><link rel="prefetch" href="/assets/js/34.16a91910.js"><link rel="prefetch" href="/assets/js/35.e417f247.js"><link rel="prefetch" href="/assets/js/36.652fd2b9.js"><link rel="prefetch" href="/assets/js/37.516ee8eb.js"><link rel="prefetch" href="/assets/js/38.5ecc0d24.js"><link rel="prefetch" href="/assets/js/39.bf60aafe.js"><link rel="prefetch" href="/assets/js/4.830dd49c.js"><link rel="prefetch" href="/assets/js/40.1cfdad06.js"><link rel="prefetch" href="/assets/js/41.6f0be6aa.js"><link rel="prefetch" href="/assets/js/42.5721a6cf.js"><link rel="prefetch" href="/assets/js/43.f12149e3.js"><link rel="prefetch" href="/assets/js/45.5455ad19.js"><link rel="prefetch" href="/assets/js/46.8cf1ef3a.js"><link rel="prefetch" href="/assets/js/47.a91e4ac3.js"><link rel="prefetch" href="/assets/js/48.16f3ac34.js"><link rel="prefetch" href="/assets/js/49.6edb73d8.js"><link rel="prefetch" href="/assets/js/5.abca6286.js"><link rel="prefetch" href="/assets/js/50.2705ac0c.js"><link rel="prefetch" href="/assets/js/51.579008f4.js"><link rel="prefetch" href="/assets/js/52.14156d8b.js"><link rel="prefetch" href="/assets/js/53.dd1c5175.js"><link rel="prefetch" href="/assets/js/54.942e94dd.js"><link rel="prefetch" href="/assets/js/55.63d4cb55.js"><link rel="prefetch" href="/assets/js/56.4275a0c8.js"><link rel="prefetch" href="/assets/js/57.8c14fcaa.js"><link rel="prefetch" href="/assets/js/58.7865e785.js"><link rel="prefetch" href="/assets/js/59.ae3154bc.js"><link rel="prefetch" href="/assets/js/6.c669e5a3.js"><link rel="prefetch" href="/assets/js/60.3e9c973b.js"><link rel="prefetch" href="/assets/js/61.e2c9b6ce.js"><link rel="prefetch" href="/assets/js/62.ad733894.js"><link rel="prefetch" href="/assets/js/63.4d43fc51.js"><link rel="prefetch" href="/assets/js/7.1f128303.js"><link rel="prefetch" href="/assets/js/8.3c822bf4.js"><link rel="prefetch" href="/assets/js/9.0c736f31.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.528ca49b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b1b38d49.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/Logo_without_text.png" alt="Wasabi Docs" class="logo"> <span class="site-name can-hide">Wasabi Docs</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/why-wasabi/" class="nav-link">
  Why Wasabi
</a></div><div class="nav-item"><a href="/using-wasabi/" class="nav-link router-link-active">
  Using Wasabi
</a></div><div class="nav-item"><a href="/building-wasabi/" class="nav-link">
  Building Wasabi
</a></div><div class="nav-item"><a href="/FAQ/" class="nav-link">
  FAQ
</a></div><div class="nav-item"><a href="/glossary/" class="nav-link">
  Glossary
</a></div> <a href="https://github.com/zkSNACKs/WasabiDoc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/why-wasabi/" class="nav-link">
  Why Wasabi
</a></div><div class="nav-item"><a href="/using-wasabi/" class="nav-link router-link-active">
  Using Wasabi
</a></div><div class="nav-item"><a href="/building-wasabi/" class="nav-link">
  Building Wasabi
</a></div><div class="nav-item"><a href="/FAQ/" class="nav-link">
  FAQ
</a></div><div class="nav-item"><a href="/glossary/" class="nav-link">
  Glossary
</a></div> <a href="https://github.com/zkSNACKs/WasabiDoc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Introducing Wasabi</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/using-wasabi/ELI5.html" class="sidebar-link">Explain Wasabi like I'm 5</a></li><li><a href="/using-wasabi/10Commandments.html" class="sidebar-link">Ten Commandments</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Installing Wasabi</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/using-wasabi/InstallPackage.html" class="sidebar-link">Install package</a></li><li><a href="/using-wasabi/BuildSource.html" class="sidebar-link">Build from source code</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Using Wasabi</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/using-wasabi/WalletGeneration.html" class="sidebar-link">Wallet Generation</a></li><li><a href="/using-wasabi/Receive.html" class="sidebar-link">Receive</a></li><li><a href="/using-wasabi/CoinJoin.html" class="sidebar-link">CoinJoin</a></li><li><a href="/using-wasabi/Send.html" class="sidebar-link">Send</a></li><li><a href="/using-wasabi/ColdWasabi.html" class="sidebar-link">Cold-Wasabi Hardware Wallet Mode</a></li><li><a href="/using-wasabi/BitcoinFullNode.html" class="sidebar-link">Bitcoin Full Node</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Privacy Best Practices</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/using-wasabi/ChangeCoins.html" class="sidebar-link">Change Coins</a></li><li><a href="/using-wasabi/Deanonimization.html" class="sidebar-link">How you can be de-anonymized using Bitcoin</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Restoring Wasabi</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/using-wasabi/WalletRecovery.html" class="sidebar-link">Recover Wasabi Wallet</a></li><li><a href="/using-wasabi/RestoreElectrum.html" class="sidebar-link">Restoring Wasabi Wallet to Electrum</a></li><li><a href="/using-wasabi/LostPassword.html" class="sidebar-link">Lost Password Strategy</a></li><li><a href="/using-wasabi/PasswordFinder.html" class="sidebar-link">Password Finder</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Advanced Installing Wasabi</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/using-wasabi/DeterministicBuild.html" class="sidebar-link">Deterministic Build</a></li><li><a href="/using-wasabi/WasabiSetupTails.html" class="sidebar-link">Wasabi Setup on Tails</a></li><li><a href="/using-wasabi/WasabiSetupVM.html" class="sidebar-link">Wasabi Setup in Virtual Machines</a></li><li><a href="/using-wasabi/WasabiSetupWhonix.html" class="sidebar-link">Wasabi Setup using Whonix</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Advanced Using Wasabi</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/using-wasabi/Daemon.html" class="sidebar-link">Headless Wasabi Daemon</a></li><li><a href="/using-wasabi/RPC.html" class="sidebar-link">RPC Interface</a></li><li><a href="/using-wasabi/LurkingWifeMode.html" class="sidebar-link">Lurking Wife Mode</a></li><li><a href="/using-wasabi/LockScreen.html" class="sidebar-link">Lock Screen</a></li><li><a href="/using-wasabi/PasswordBestPractices.html" class="sidebar-link">Password Best Practices</a></li><li><a href="/using-wasabi/BIPs.html" class="sidebar-link">Supported BIPs</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Research</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/using-wasabi/Joinmarket.html" class="sidebar-link">JoinMarket</a></li><li><a href="/using-wasabi/PayToEndPoint.html" class="active sidebar-link">Pay to EndPoint</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/using-wasabi/PayToEndPoint.html#the-basics" class="sidebar-link">The Basics</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/using-wasabi/PayToEndPoint.html#p2ip" class="sidebar-link">P2IP</a></li><li class="sidebar-sub-header"><a href="/using-wasabi/PayToEndPoint.html#bulletproofs" class="sidebar-link">Bulletproofs</a></li><li class="sidebar-sub-header"><a href="/using-wasabi/PayToEndPoint.html#coinjoin" class="sidebar-link">CoinJoin</a></li><li class="sidebar-sub-header"><a href="/using-wasabi/PayToEndPoint.html#blockchain-heuristics" class="sidebar-link">Blockchain Heuristics</a></li><li class="sidebar-sub-header"><a href="/using-wasabi/PayToEndPoint.html#clusterfuck-wallet" class="sidebar-link">Clusterfuck Wallet</a></li></ul></li><li class="sidebar-sub-header"><a href="/using-wasabi/PayToEndPoint.html#the-protocol" class="sidebar-link">The Protocol</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/using-wasabi/PayToEndPoint.html#part-1-end-to-end-connection-establishment" class="sidebar-link">Part 1: End-To-End Connection Establishment</a></li><li class="sidebar-sub-header"><a href="/using-wasabi/PayToEndPoint.html#part-2-sender-receiver-coinjoin" class="sidebar-link">Part 2: Sender-Receiver CoinJoin</a></li><li class="sidebar-sub-header"><a href="/using-wasabi/PayToEndPoint.html#extensions" class="sidebar-link">Extensions</a></li></ul></li><li class="sidebar-sub-header"><a href="/using-wasabi/PayToEndPoint.html#the-novelty-of-sender-receiver-scheme" class="sidebar-link">The Novelty of Sender-Receiver Scheme</a></li><li class="sidebar-sub-header"><a href="/using-wasabi/PayToEndPoint.html#conclusion" class="sidebar-link">Conclusion</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="pay-to-endpoint"><a href="#pay-to-endpoint" class="header-anchor">#</a> Pay To EndPoint</h1> <p></p><div class="table-of-contents"><ul><li><a href="#the-basics">The Basics</a><ul><li><a href="#p2ip">P2IP</a></li><li><a href="#bulletproofs">Bulletproofs</a></li><li><a href="#coinjoin">CoinJoin</a></li><li><a href="#blockchain-heuristics">Blockchain Heuristics</a></li><li><a href="#clusterfuck-wallet">Clusterfuck Wallet</a></li></ul></li><li><a href="#the-protocol">The Protocol</a><ul><li><a href="#part-1-end-to-end-connection-establishment">Part 1: End-To-End Connection Establishment</a></li><li><a href="#part-2-sender-receiver-coinjoin">Part 2: Sender-Receiver CoinJoin</a></li><li><a href="#extensions">Extensions</a></li></ul></li><li><a href="#the-novelty-of-sender-receiver-scheme">The Novelty of Sender-Receiver Scheme</a></li><li><a href="#conclusion">Conclusion</a></li></ul></div><p></p> <hr> <blockquote><p>Satoshi's Vision + CoinJoin + Bulletproofs = Sad Blockchain Analysts</p></blockquote> <p>I attended a brainstorming event on Bitcoin privacy.
In this article, I will assume all participants of this meeting would like to remain anonymous, unless she or he explicitly asks me to properly credit her or him.
To keep this post coherent, I will refer to specific participants as Jessie, James and Meowth in an interchangeable, (not pseudonymous) way, hence Team Rocket.</p> <p>My goal today is to put out one of the ideas of this meeting in a digestible way.
I assume some other Team Rocket member will do the same, in their own way.
But first, let me walk you through some basic concepts.
But before that, I’d like to credit some attendees and link to their articles on the event.</p> <h4 id="non-anonymous-attendees"><a href="#non-anonymous-attendees" class="header-anchor">#</a> Non-Anonymous Attendees</h4> <ul><li><a href="https://twitter.com/wintercooled" target="_blank" rel="noopener noreferrer">Matthew Haywood<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://twitter.com/adam3us" target="_blank" rel="noopener noreferrer">Adam Back<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://twitter.com/notgrubles" target="_blank" rel="noopener noreferrer">Grubles<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://twitter.com/dangershony" target="_blank" rel="noopener noreferrer">Danger Shony<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://twitter.com/real_or_random" target="_blank" rel="noopener noreferrer">Tim Ruffing<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://twitter.com/waxwing__" target="_blank" rel="noopener noreferrer">Adam Gibson<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="the-basics"><a href="#the-basics" class="header-anchor">#</a> The Basics</h2> <h3 id="p2ip"><a href="#p2ip" class="header-anchor">#</a> P2IP</h3> <blockquote><p>Bitcoin 0.1 supported Bitcoin addresses just like today, but it also had a “pay to IP address” feature.
When you used this, you’d connect to the IP and get the sender’s full public key, and then send to that.
[…] Pay-to-IP was removed around 0.5, I think. — <a href="https://reddit.com/u/theymos" target="_blank" rel="noopener noreferrer">Theymos<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, 2016</p></blockquote> <p>Satoshi built a feature into Bitcoin, called P2IP.
This has terrible security and privacy drawbacks, so it was removed.
Little we knew, when we came up with our Pay To EndPoint (P2EP) scheme, that we reinvented this feature, but in a secure and a privacy enhancing way.
In our scheme the EndPoint can not only be an IP address, but also a domain, preferably a Tor onion.</p> <p>When Jessie realized what we have done, she jokingly noted: <em>&quot;We perfected Satoshi's vision!&quot;</em></p> <h3 id="bulletproofs"><a href="#bulletproofs" class="header-anchor">#</a> Bulletproofs</h3> <p>Bulletproofs (BP) is a zero-knowledge proof system, often cited together with Confidential Transactions.
However we use BP for a different purpose.
We utilize it to prevent a UTXO spoofing attack, that I will expand upon later.
However James argues, we do not even need to deal with the implementation complexity of Bulletproofs, since a simple cut and choose defense might be sufficient.</p> <p>It is also worth noting, that our scheme does not require any soft or hard fork.</p> <h3 id="coinjoin"><a href="#coinjoin" class="header-anchor">#</a> CoinJoin</h3> <p>My regular readers are probably sick of me repeatedly explaining CoinJoin, (CJ) so feel free to skip this two sentences here.
CJ stands for joining multiple users’ inputs into one transaction.
It is also worth pointing out that most CJ scheme uses equal sized outputs.
If it does not, then it provides zero privacy. But that is just an oversimplification, I often say.
No matter how unintuitive it may seem, there are CJs with unequal sized outputs those still provide privacy, because the adversary have to recognize this was a CJ transaction in the first place.
I will expand upon it later.</p> <h3 id="blockchain-heuristics"><a href="#blockchain-heuristics" class="header-anchor">#</a> Blockchain Heuristics</h3> <p>Blockchain Heuristics are the methods Blockchain Analytics uses to deanonymize you.
These companies are founded on these heuristics. The scheme Team Rocket is proposing breaks some of these heuristics to the point that today’s Blockchain Analysis would be instantly broken, even if you do not use our scheme, since it would be really hard to figure out if you used P2EP or not.</p> <h4 id="heuristic-1-all-inputs-are-co-owned"><a href="#heuristic-1-all-inputs-are-co-owned" class="header-anchor">#</a> Heuristic 1: All inputs are co-owned.</h4> <p>This means, if you are joining together more than one input, then it must all come from you.
You could say that CJ breaks this assumption instantly, but (equal sized) CJ is easily identifiable, so that is easy to handle.</p> <h4 id="mixing-heuristics-subset-sum-analysis"><a href="#mixing-heuristics-subset-sum-analysis" class="header-anchor">#</a> Mixing Heuristics: Subset-Sum Analysis.</h4> <p>This heuristics can be applied to CJ transactions, (and all mixing technique in general,) where the output sizes are not equal.
For example if James and Meowth joins their 1 BTC and 2 BTC coins together and the outputs would be 2 BTC and 1 BTC, it is easy to delink that transaction.
Note, it is only possible if CJ transaction was identified.</p> <h4 id="heuristics-meta-what-doesn-t-exist-doesn-t-exist"><a href="#heuristics-meta-what-doesn-t-exist-doesn-t-exist" class="header-anchor">#</a> Heuristics Meta: What Doesn’t Exist Doesn’t Exist.</h4> <p>It is evident, but it is worth pointing out.
If Blockchain Analysis sees a transaction on the Blockchain that theoretically can be interpreted in many different ways, but in practice only one way of interpretation is implemented at that point in time, then that interpretation is what Blockchain Analysis assumes.
This is why it is really easy to be anonymous with Bitcoin today.
Just get familiar with some Blockchain Analysis heuristics, break them manually and they will interpret your transaction in the wrong way with 99% accuracy, because you are the only person who builds such transaction in the world and they are not aware of them.
To denounce the evils of Blockchain Analytics!</p> <p>To go to town with heuristics, see Adam Gibson’s <a href="https://www.youtube.com/watch?v=XORDEX-RrAI&amp;feature=youtu.be&amp;t=23359" target="_blank" rel="noopener noreferrer">Building on Bitcoin talk<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, Kristov Atlas’s <a href="https://www.coinjoinsudoku.com" target="_blank" rel="noopener noreferrer">CoinJoin Sudoku<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, where he broke Blockchain info’s now discontinued SharedCoin feature and <a href="https://www.youtube.com/watch?v=HScK4pkDNds" target="_blank" rel="noopener noreferrer">Nick Jonas’s 2016 talk<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> in a Zurich Meetup.</p> <h3 id="clusterfuck-wallet"><a href="#clusterfuck-wallet" class="header-anchor">#</a> Clusterfuck Wallet</h3> <p>The last concept I would like to get you familiar with is something I have written about.
It is the <a href="https://medium.com/@nopara73/new-bitcoin-anonymity-technique-the-clusterfuck-wallet-d48aa1787324" target="_blank" rel="noopener noreferrer">clusterfuck wallet<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.
This is either the craziest idea I ever had or the most brilliant one
medium.com</p> <blockquote><p>I remember reading a while ago Mircea Popescu’s ridiculous article, where he states something like Bitcoin is perfectly anonymous.
His reasoning went like this: Blockchain analysis cannot make any reasonable conclusion, because a Bitcoin transaction can be interpreted in many different ways. — Ádám Ficsor</p></blockquote> <p>The goal of this wallet was to make Blockchain Heuristics as unreliable as it can get, by take advantage of Heuristics Meta: What Doesn’t Exist Doesn’t Exist.
The idea is: make them to exist. With that creating chaos, or “clusterfuck” if you like.
Turns out P2EP is a great tool to bring many exotic transactions into existence, not only the one the Team Moon Rocket is proposing here.</p> <h2 id="the-protocol"><a href="#the-protocol" class="header-anchor">#</a> The Protocol</h2> <h3 id="part-1-end-to-end-connection-establishment"><a href="#part-1-end-to-end-connection-establishment" class="header-anchor">#</a> Part 1: End-To-End Connection Establishment</h3> <p>The idea is to make the recipient participate in the transaction, which would be great for many different reasons, I will come back to later.
For now, we had a practical problem to solve.
How do we establish a connection between the sender and the recipient in a P2P way?</p> <p>Jessie’s idea was to extend the <a href="/using-wasabi/BIPs.html#bip-21-uri-scheme">BIP21 Bitcoin URI Scheme</a> with an endpoint.
Somehow like this:
<code>bitcoin:175tWpb8K1S7NmH4Zx6rewF9WQrcZv245W?endpoint=http://3g2upl4pq6kufc4m.onion</code></p> <p>In this case, first the sender would try to figure out if the recipient is online.
If it is, then make a joint transaction together.
If it is not, then make the transaction in the traditional way.
The problem is <a href="/using-wasabi/BIPs.html#bip-21-uri-scheme">BIP 21</a> is not fully adopted and it would be confusing to some user to copypaste a <a href="/using-wasabi/BIPs.html#bip-21-uri-scheme">BIP 21</a> uri instead of just an address.
Team Rocket still debates if this is acceptable or not.</p> <p><strong>James has provided an arguably infeasible solution to this issue. What if we would generate the endpoint from the given Bitcoin address?</strong></p> <p>In this case, UX would stay the same: the receiver gives a Bitcoin address to the sender.
However in the background the sender would try to establish a connection to the location corresponding to the Bitcoin address given and if that does not work, the sender sends the transaction normally.</p> <p>The impracticality of James’s idea is that we would need either our own anonymity network to achieve this, like a fork of Tor or we would have to convince an existing anonymity network to incorporate our scheme.
Nevertheless, the idea is novel and worth keeping in mind.</p> <h3 id="part-2-sender-receiver-coinjoin"><a href="#part-2-sender-receiver-coinjoin" class="header-anchor">#</a> Part 2: Sender-Receiver CoinJoin</h3> <p>It may seem like I do not even have to say more, because negotiating a transaction where the sender and the recipient both participates is not that hard, especially that they usually trust each other, right?
Wrong.
Their was a point where Team Rocket gave up on this scheme, because they thought they encountered an unsolvable issue.</p> <p>What if a random sender connects to a publicly known receiver, start negotiating the transaction and ends up not signing in the end? So the sender would learn a UTXO of the receiver and run away with that sensitive information, without following up.</p> <p>In the most desperate moment Meowth had an idea: What if the receiver would feed the sender with fake UTXOs for a while, forcing the sender to sign a final transaction every time, but only the final, transaction with the receiver’s real UTXO would be broadcasted at the end?</p> <p>In this case, if the sender is malicious and does not follow up, the only thing he can learn is “there is a small chance of probability that this utxo is the receiver’s.”
We called this to <strong>The Serial Method</strong>.
James quickly came up with <strong>The Parallel Method</strong>, where many UTXOs would be sent in parallel and one of them is the real one.
It reduces the number of rounds, however it tells the attacker that one of the UTXO is the real UTXO.</p> <p>And finally Jessie came up with something elegant: <strong>The Bulletproofs Method</strong>.
But I will not pretend that I fully understand it and I will leave it to others to expand upon the exact way of doing this.
The bottom line is, both the Serial and the Parallel method leaks a small amount of information, the Bulletproofs method does not leak any, and it does not need monitoring the Blockchain to select fake UTXOs.</p> <h3 id="extensions"><a href="#extensions" class="header-anchor">#</a> Extensions</h3> <p>Before I explain the novelty of Part 2: Sender-Receiver CoinJoin protocol, I would like to point out that, Part 1: End-To-End Connection Establishment protocol has a side effect, namely it can be used to facilitate many things, I described in the Clusterfuck Wallet post.
One thing this can easily facilitate is merge avoidance.
If the sender would want to join multiple coins together, it could ask for multiple Bitcoin addresses from the receiver and send the coins one by one.
It could also establish a future cooperation with the receiver.
For example, the receiver, if online could participate in later transactions of the sender, thus breaking Heuristics 1 and Meta.
But really, if this P2EP would get adopted, the limit of the number of strange schemes, all breaking Blockchain Analysis assumptions is just the developer’s imagination.</p> <h2 id="the-novelty-of-sender-receiver-scheme"><a href="#the-novelty-of-sender-receiver-scheme" class="header-anchor">#</a> The Novelty of Sender-Receiver Scheme</h2> <p>If Blockchain Analysis looks at the transaction above, it will deduct:</p> <ul><li>The sender paid 6 BTC to the receiver.</li> <li>The largest coin of the sender was 5 BTC.</li> <li>The change is 2 BTC.</li></ul> <p>And some other things.
However if it the receiver participated in the transaction above, then this transaction could be interpreted in multiple ways, <strong>breaking some blockchain analysis heuristics, not only the transaction level, but globally!</strong> Remember Heuristics Meta?
What does not exist, that does not exist.
Thus if some people start using strange schemes, that affects how Blockchain analysis interprets other transactions, too.</p> <h4 id="side-effect-1"><a href="#side-effect-1" class="header-anchor">#</a> Side effect 1:</h4> <p>In exchange for the privacy benefit, the sender has to pay more fees than a normal transaction.
It is a con for the sender, but a pro for the receiver, since the receiver does not have to consolidate its coin later.
Also it is a pro from a global point of view, due to its UTXO consolidation effects, I will detail a few lines below.</p> <h4 id="side-effect-2"><a href="#side-effect-2" class="header-anchor">#</a> Side effect 2:</h4> <p>Harder to coordinate, since the receiver must be online and the payment will take a few seconds longer.
But it is arguable, that if everyone would be able to use this scheme all the time, then that would be the new pattern, thus the new reliable Heuristics for Blockchain analysis.
It is crucial that not everyone use this pattern all the time. Its practical limitations achieves its goal.</p> <h4 id="side-effect-3"><a href="#side-effect-3" class="header-anchor">#</a> Side effect 3:</h4> <p>Receiver must have a hot wallet.
This is problematic in a buyer to merchant payment, since merchants usually receive coins to cold wallets.
While my above comment still applies here, notice that this notion makes our problem of UTXO spying a corner case?
That attack only applied if “the receiver is publicly known.”
In peer to peer, person to person payments, the attacker would have to somehow first acquire an endpoint to a receiver.</p> <h4 id="side-effect-4"><a href="#side-effect-4" class="header-anchor">#</a> Side effect 4:</h4> <p>Wallets must be deencrypted.
Since many wallets only send-time decrypt the private keys, it would need to decrypt receive-time, too.
There are multiple ways to implement this.
It could be implemented in address generation time, which in our case it is also an endpoint generation time.
But if it is strictly implemented at receive time, the UTXO spying defense may not be needed at all.</p> <h4 id="side-effect-5"><a href="#side-effect-5" class="header-anchor">#</a> Side effect 5:</h4> <p>It helps with UTXO bloat.
Let us assume the above transaction is a Sender-Receiver transaction.
Then, if the receiver would not participate, that would mostly result in a one input, two output transaction.
This also means, the receiver would not have to consolidate its UTXOs later, which is a huge win for privacy.</p> <h2 id="conclusion"><a href="#conclusion" class="header-anchor">#</a> Conclusion</h2> <p>Overall, I feel this scheme can help a lot in Bitcoin’s privacy globally, especially if it is mixed with other clusterfuck wallet techniques.
However, it must be said, there are some practical problems with it on the receiver’s side. Nevertheless it is simple to implement on the sender side and it affects globally everyone’s privacy, even those who do not use this scheme.</p> <p>In the end… at the very least.
Crazy ideas always worth writing down.
Sometimes they end up changing things.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/zkSNACKs/WasabiDoc/edit/master/docs/using-wasabi/PayToEndPoint.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/14/2020, 9:24:00 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/using-wasabi/Joinmarket.html" class="prev">
        JoinMarket
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.530dcfea.js" defer></script><script src="/assets/js/3.b572bdb5.js" defer></script><script src="/assets/js/44.63e6a1bf.js" defer></script>
  </body>
</html>
